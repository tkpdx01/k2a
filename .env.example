# ============================================================================
# kiro2api 环境配置文件示例
# ============================================================================
# 复制此文件为 .env 并根据需要修改配置

# ============================================================================
# Token管理配置（必需）
# ============================================================================
#
# 使用JSON格式配置认证信息，支持多认证方式和多token
# 支持两种配置方式：
#   1. 直接配置JSON字符串（推荐用于简单配置）
#   2. 配置文件路径（推荐用于复杂配置或敏感信息管理）
#
# 基本格式：
# KIRO_AUTH_TOKEN='[认证配置对象数组]'
# 或
# KIRO_AUTH_TOKEN=/path/to/auth_config.json
#
# 每个认证配置对象包含：
# - auth: 认证方式，可选值为 "Social" 或 "IdC"
# - refreshToken: 刷新令牌（必需）
# - clientId: IdC认证的客户端ID（IdC认证时必需）
# - clientSecret: IdC认证的客户端密钥（IdC认证时必需）
# - disabled: 是否禁用此配置（可选，默认false）
# ============================================================================
# Token获取方式
# ============================================================================
#
# Social tokens:
#   通常位于 ~/.aws/sso/cache/ 目录下的JSON文件中
#   文件名类似：kiro-auth-token.json 或包含 "refreshToken" 字段的缓存文件
#
# IdC tokens:
#   位于 ~/.aws/sso/cache/ 目录下的JSON文件中
#   需要同时提供 clientId 和 clientSecret
#
# 方式1：直接配置JSON字符串
# 示例1：单个 Social 认证
KIRO_AUTH_TOKEN='[{"auth":"Social","refreshToken":"your_social_refresh_token_here"}]'

# 方式2：配置文件路径（系统会优先检查是否为文件）
# KIRO_AUTH_TOKEN=/path/to/auth_config.json
# KIRO_AUTH_TOKEN=./config/auth.json

# 示例2：单个 IdC 认证
# KIRO_AUTH_TOKEN='[{"auth":"IdC","refreshToken":"your_idc_refresh_token_here","clientId":"your_idc_client_id","clientSecret":"your_idc_client_secret"}]'

# 示例3：多个认证混合
# KIRO_AUTH_TOKEN='[
#   {
#     "auth": "Social",
#     "refreshToken": "aorAAAAAGj....."
#   },
#   {
#     "auth": "IdC",
#     "refreshToken": "aorAAAAAGj....",
#     "clientId": "uG-18bI....",
#     "clientSecret": "eyJraWQiOiJrZXktM....."
#   }
# ]'
# ============================================================================
# Token获取方式
# ============================================================================
#
# Social tokens:
#   通常位于 ~/.aws/sso/cache/ 目录下的JSON文件中
#   文件名类似：kiro-auth-token.json 或包含 "refreshToken" 字段的缓存文件
#
# IdC tokens:
#   位于 ~/.aws/sso/cache/ 目录下的JSON文件中
#   需要同时提供 clientId 和 clientSecret
#
# Token选择策略：
# - 系统使用"顺序选择"策略（sequential）
# - 按配置顺序依次使用token，当前token耗尽后自动切换到下一个
# - 支持多token自动负载均衡和容错

# ============================================================================
# 基础服务配置
# ============================================================================

# 服务端口（默认: 8080）
PORT=8080

# API认证密钥（默认: 123456）
KIRO_CLIENT_TOKEN=123456

# Gin运行模式: debug, release, test（默认: release）
GIN_MODE=release

# ============================================================================
# 日志配置
# ============================================================================

# 日志级别: debug, info, warn, error（默认: info）
LOG_LEVEL=info

# 日志格式: text, json（默认: json）
LOG_FORMAT=json

# 日志文件路径（可选，不设置则只输出到控制台）
# LOG_FILE=/var/log/kiro2api.log

# 控制台输出开关（默认: true）
# LOG_CONSOLE=true

# ============================================================================
# 代理配置（可选）
# ============================================================================
#
# 方式1：标准环境变量代理（全局生效）
# HTTP_PROXY: HTTP 请求的代理服务器地址
# HTTPS_PROXY: HTTPS 请求的代理服务器地址
# NO_PROXY: 不使用代理的主机列表（逗号分隔）
#
# 示例：
# HTTP_PROXY=http://proxy.example.com:8080
# HTTPS_PROXY=http://proxy.example.com:8080
# NO_PROXY=localhost,127.0.0.1,.local

# ============================================================================
# 代理池配置（可选，防封号增强）
# ============================================================================
#
# 方式2：代理池（支持多代理轮换，防封号）
# PROXY_POOL: 代理URL列表，逗号分隔
#
# 代理池功能：
# - 随机选择策略：避免单一代理过度使用
# - 使用次数限制：单个代理最多使用10次后轮换
# - 健康检查机制：定期验证代理可用性
# - 失败标记：连续失败3次后标记为不健康
# - 自动恢复：冷却60秒后重新尝试
#
# 支持的代理格式：
# - http://ip:port
# - http://user:pass@ip:port
# - socks5://ip:port
#
# 示例（Cloudflare WARP代理）：
# PROXY_POOL=http://127.0.0.1:40000,http://127.0.0.1:40001,http://127.0.0.1:40002
#
# 示例（带认证的代理）：
# PROXY_POOL=http://user:pass@proxy1.com:8080,http://user:pass@proxy2.com:8080
# HTTPS_PROXY=http://proxy.example.com:8080
# NO_PROXY=localhost,127.0.0.1,.local

# ============================================================================
# 防封号配置（增强版 v2.0）
# ============================================================================
#
# 以下配置支持环境变量覆盖，默认值已针对防封进行优化
#
# ========== 请求间隔配置 ==========
#
# 单token最小请求间隔（默认: 5s，原来是2s）
# 格式: 数字+单位，如 "5s", "1m", "500ms"
# RATE_LIMIT_MIN_INTERVAL=5s
#
# 单token最大请求间隔（默认: 15s，原来是5s）
# 实际间隔会在 min 和 max 之间随机选择
# RATE_LIMIT_MAX_INTERVAL=15s
#
# 全局最小请求间隔（默认: 2s，原来是500ms）
# 所有token共享的最小间隔
# RATE_LIMIT_GLOBAL_MIN_INTERVAL=2s
#
# ========== Token轮换配置 ==========
#
# 单token最大连续使用次数（默认: 3次，原来是5次）
# 达到此次数后自动切换到下一个token
# RATE_LIMIT_MAX_CONSECUTIVE=3
#
# ========== 冷却与退避配置 ==========
#
# Token冷却时间（默认: 5m，原来是30s）
# 收到403/429错误后，token进入冷却期
# RATE_LIMIT_COOLDOWN=5m
#
# 指数退避基数（默认: 1m）
# 第一次失败后等待此时间，后续翻倍
# RATE_LIMIT_BACKOFF_BASE=1m
#
# 指数退避最大值（默认: 30m）
# 退避时间不会超过此值
# RATE_LIMIT_BACKOFF_MAX=30m
#
# 指数退避倍数（默认: 2.0）
# 每次失败后，等待时间乘以此倍数
# RATE_LIMIT_BACKOFF_MULTIPLIER=2.0
#
# ========== 每日限制配置 ==========
#
# 每个token每日最大请求次数（默认: 500）
# 设为0表示不限制
# RATE_LIMIT_DAILY_MAX=500
#
# ========== 请求抖动配置 ==========
#
# 请求间隔抖动百分比（默认: 30）
# 在基础间隔上增加 0-30% 的随机抖动，使请求更像人类行为
# RATE_LIMIT_JITTER_PERCENT=30
#
# ========== Token缓存配置 ==========
#
# Token缓存生存时间（默认: 5m）
# TOKEN_CACHE_TTL=5m

# ============================================================================
# 防封号功能说明（v2.0 增强版）
# ============================================================================
#
# 1. 请求指纹随机化：
#    - 每个token绑定唯一的客户端指纹
#    - 包括：UA、语言、时区、屏幕分辨率、CPU核心数等
#    - 指纹在token生命周期内保持一致
#
# 2. 智能请求间隔：
#    - 随机间隔5-15秒（可配置）
#    - 额外30%随机抖动
#    - 模拟人类操作节奏
#
# 3. 智能token轮换：
#    - 基于剩余额度加权选择
#    - 连续使用3次后自动切换
#    - 避免单一token过度使用
#
# 4. 指数退避机制：
#    - 收到403/429后触发
#    - 第1次失败: 等待1分钟
#    - 第2次失败: 等待2分钟
#    - 第3次失败: 等待4分钟
#    - 最大等待30分钟
#
# 5. 每日请求限制：
#    - 每个token每日最多500次请求
#    - 自动在UTC 00:00重置
#    - 防止单日过度使用
#
# 6. 冷却期检查：
#    - 在冷却期内的token不会被选中
#    - 冷却期结束后自动恢复
#
# 查看防封号状态：GET /api/anti-ban/status

# ============================================================================
# 最佳实践
# ============================================================================
#
# 1. 生产环境配置：
#    - 使用 GIN_MODE=release
#    - 配置多个token实现负载均衡（建议3-5个）
#    - 设置 LOG_LEVEL=info 或 warn
#    - 启用日志文件记录: LOG_FILE=/var/log/kiro2api.log
#    - 【强烈建议】配置代理池: PROXY_POOL=...
#
# 2. 开发环境配置：
#    - 使用 GIN_MODE=debug
#    - 设置 LOG_LEVEL=debug
#    - 保持控制台输出: LOG_CONSOLE=true
#
# 3. 防封号最佳实践：
#    - 配置多个token（至少2-3个）
#    - 使用代理池（不同IP轮换）
#    - 控制请求频率（不要太频繁）
#    - 避免长时间连续使用
#    - 定期检查 /api/anti-ban/status
#
# 4. 故障排除：
#    - 启用 LOG_LEVEL=debug 查看详细日志
#    - 检查token是否过期：查看日志中的"token刷新"相关信息
#    - 验证JSON格式：使用在线JSON验证器检查KIRO_AUTH_TOKEN格式
#    - 检查使用限制：日志会显示剩余可用次数
#    - 检查冷却状态：访问 /api/anti-ban/status
